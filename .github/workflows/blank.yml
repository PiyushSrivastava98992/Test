name: CI Pipeline

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Run build
        run: |
          echo "Running build..."
          # Simulate error
          # exit 1

      - name: Send Notification to Outlook via Webhook
        if: always() # ensures it runs even if previous steps fail
        run: |
          STATUS="success"
          if [ "${{ job.status }}" != "success" ]; then
            STATUS="failed"
          fi

          curl -X POST \
            -H "Content-Type: application/json" \
            -d "{
              \"user\": \"${{ github.actor }}\",
              \"time\": \"$(date -u +'%Y-%m-%dT%H:%M:%SZ')\",
              \"project\": \"${{ github.repository_owner }}\",
              \"repo\": \"${{ github.repository }}\",
              \"workflow\": \"${{ github.workflow }}\",
              \"run_id\": \"${{ github.run_id }}\",
              \"run_number\": \"${{ github.run_number }}\",
              \"branch\": \"${{ github.ref_name }}\",
              \"commit\": \"${{ github.sha }}\",
              \"status\": \"${STATUS}\",
              \"error\": \"${{ job.status == 'failure' && 'See logs in GitHub Actions' || '' }}\",
              \"message\": \"Pipeline $STATUS for ${{ github.repository }}\"
            }" \
            "https://prod-12.centralindia.logic.azure.com:443/workflows/.../triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=7D..."
